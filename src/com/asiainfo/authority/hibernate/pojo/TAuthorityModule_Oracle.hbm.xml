<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- Mapping file autogenerated by MyEclipse Persistence Tools
    tool.T_AUTHORITY_MODULE  
    LXC.T_XT_CDXX
-->
<hibernate-mapping>
	<class name="com.asiainfo.authority.hibernate.pojo.TAuthorityModule" table="t_authority_module" schema="tool" 
		dynamic-insert="true" dynamic-update="true" >
		<id name="NMid" type="java.lang.Integer">
			<column name="N_MID" precision="8" scale="0" />
			<!-- MySQL、DB2、MS SQL Server
			MySQL：create table t_user(id int auto_increment primary key, name varchar(20));
			SQL Server：create table t_user(id int identity(1,1) primary key, name varchar(20));
			 -->
			<generator class="identity" />
<!-- 			<generator class="sequence"> -->
<!-- 				<param name="sequence">SEQ_AUTHORITY_MODULE_ID</param> -->
<!-- 			</generator> -->
		</id>
		<property name="CMname" type="java.lang.String">
			<column name="C_MNAME" length="90" not-null="true" unique="true" />
		</property>
		<property name="CMleaf" type="java.lang.String">
			<column name="C_MLEAF" length="5" not-null="true" />
		</property>
		<property name="NMlevel" type="java.lang.Short">
			<column name="N_MLEVEL" precision="3" scale="0" not-null="true" />
		</property>
		<property name="NMparent" type="java.lang.Integer">
			<column name="N_MPARENT" precision="8" scale="0" />
		</property>
<!-- 		<many-to-one name="NMparent" column="N_MPARENT" class="com.asiainfo.authority.hibernate.pojo.TAuthorityModule" unique="true" -->
<!-- 			fetch="select" lazy="false" not-null="false" /> -->
			
		<property name="NMorder" type="java.lang.Short">
			<column name="N_MORDER" precision="3" scale="0" not-null="true" />
		</property>
		<property name="CMtarget" type="java.lang.String">
			<column name="C_MTARGET" length="3" />
		</property>
		<property name="CMiconcls" type="java.lang.String">
			<column name="C_MICONCLS" length="30" />
		</property>
		<property name="CMexpanded" type="java.lang.String">
			<column name="C_MEXPANDED" length="5" not-null="true" />
		</property>
		<property name="CMchecked" type="java.lang.String">
			<column name="C_MCHECKED" length="5" not-null="true" />
		</property>
		<property name="CMpath" type="java.lang.String">
			<column name="C_MPATH" length="120" />
		</property>
		<property name="CMnote" type="java.lang.String">
			<column name="C_MNOTE" length="512" />
		</property>
		<property name="CMcreator" type="java.lang.String">
			<column name="C_MCREATOR" length="24" />
		</property>
		<property name="CMcip" type="java.lang.String">
			<column name="C_MCIP" length="60" not-null="false" />
		</property>
		<property name="CMctime" type="java.util.Date" insert="false">
			<column name="C_MCTIME" length="7" not-null="true" />
		</property>
		<property name="CMmodifier" type="java.lang.String">
			<column name="C_MMODIFIER" length="24" />
		</property>
		<property name="CMmip" type="java.lang.String">
			<column name="C_MMIP" length="60" />
		</property>
		<property name="CMmtime" type="java.util.Date" insert="false">
			<column name="C_MMTIME" length="7" />
		</property>
		<property name="CMons" type="java.lang.String" insert="false">
			<column name="C_MONS" length="1"/>
		</property>
		<property name="CMont" type="java.util.Date">
			<column name="C_MONT" length="7" />
		</property>
	</class>
<!-- 典型的向上查询 -->
    <sql-query name="findModuleByUserId_SQLQuery">
      <return alias="modu" class="com.asiainfo.authority.hibernate.pojo.TAuthorityModule">
	  </return>
	  <![CDATA[	
select distinct 
	   t1.N_MID       AS {modu.NMid},
       t1.C_MNAME     AS {modu.CMname},
       t1.N_MLEVEL    AS {modu.NMlevel},
       t1.C_MLEAF     AS {modu.CMleaf},
       t1.N_MORDER    AS {modu.NMorder},
       t1.N_MPARENT   AS {modu.NMparent},
       t1.C_MTARGET   AS {modu.CMtarget},
       t1.C_MICONCLS  AS {modu.CMiconcls},
       t1.C_MEXPANDED AS {modu.CMexpanded},
       t1.C_MCHECKED  AS {modu.CMchecked},
       t1.C_MPATH     AS {modu.CMpath},
       t1.C_MNOTE     AS {modu.CMnote},
       t1.C_MCTIME    AS {modu.CMctime},
       t1.C_MCIP      AS {modu.CMcip},
       t1.C_MCREATOR  AS {modu.CMcreator},
       t1.C_MMTIME    AS {modu.CMmtime},
       t1.C_MMIP      AS {modu.CMmip},
       t1.C_MMODIFIER AS {modu.CMmodifier},
       t1.C_MONS      AS {modu.CMons},
       t1.C_MONT      AS {modu.CMont}
  from tool.t_authority_module t1 
 start with t1.N_Mid 
    in 
     (
      select a.n_mid
        from tool.t_authority_module a 
       where a.n_mid 
          in 
           (
            select distinct b.n_mid 
              from tool.t_authority_rmrelation b 
            where b.n_rid in 
            (
                select c.n_rid from tool.t_authority_urrelation c where c.n_uid = :userId
            )
           )
     ) connect by prior t1.N_Mparent=t1.N_Mid
order by t1.N_Mlevel, t1.N_Morder
  ]]>
	</sql-query>
</hibernate-mapping>
